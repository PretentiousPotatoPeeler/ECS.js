<script type="text/javascript" src="components.js"></script>
<script type="text/javascript" src="entity.js"></script>
<script type="text/javascript" src="input.js"></script>

<body style="margin: 0px">
<canvas id="myCanvas">
</canvas>
</body>

<script>
    var CANVAS_WIDTH = window.innerWidth;
    var CANVAS_HEIGHT = window.innerHeight;
    var GRID_SIZE = 32;

    canvasElem = document.getElementById("myCanvas");
    canvasElem.width = CANVAS_WIDTH;
    canvasElem.height = CANVAS_HEIGHT;
    canvas = canvasElem.getContext("2d");
</script>

<script type="text/javascript">

    var entities = [];

    var player = new Entity("player");
    player.addModel(new Square(player, 10, 10, -1, -1, false));
    player.addModel(new ImageModel(player, "img/idiot.gif", true));
    player.addController(new ArrowMove(player));
    player.addController(new Selectable(player));

    var block = new Entity("stone");
    block.addModel(new Square(block, 1, 1, -1, -1, false, true));
    block.addModel(new ImageModel(block, "img/blocks/stone.png", true));

    var block1 = new Entity("stone");
    block1.addModel(new Square(block1, 2, 1, -1, -1, false, true));
    block1.addModel(new ImageModel(block1, "img/blocks/stone.png", true));

    var tree = new Entity("tree");
    tree.addModel(new Square(tree, 1, 2, -1, -1, false, true));
    tree.addModel(new ImageModel(tree, "img/blocks/tree.png", true));

    entities.push(block);
    entities.push(player);
    entities.push(block);
    entities.push(block1);
    entities.push(tree);

    var FPS = 30;
    setInterval(function () {
        update();
        draw();
    }, 1000 / FPS);

    function draw() {
        canvas.clearRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);
        entities.forEach(function (elem) {
            for (var com in elem.view) {
                if (elem.view[com].hasOwnProperty("draw")) {
                    elem.view[com].draw();
                }
            }
        });
    }

    function update() {
        entities.forEach(function (elem) {
            for (var com in elem.controller) {
                if (elem.controller[com].hasOwnProperty("update")) {
                    elem.controller[com].update();
                }
            }
        });
        // To prevent the bug in which the player walks away
        // from the clicked position and loses selection.
        Mouse._used = true;
    }

</script>